# Система рекомендаций вакансий с использованием МПС sequentialthinking

## Обзор

Система рекомендаций вакансий предоставляет персонализированные рекомендации для пользователей на основе их предпочтений, истории просмотров и избранных вакансий. Система использует МПС (Model Context Protocol) sequentialthinking для анализа и ранжирования вакансий.

## Архитектура

Система рекомендаций состоит из следующих компонентов:

1. **Хук `useJobRecommendations`** - React-хук для получения рекомендаций вакансий
2. **API-маршрут `/api/recommendations`** - Серверная функция для получения и ранжирования вакансий
3. **Компонент `JobRecommendations`** - UI-компонент для отображения рекомендуемых вакансий
4. **МПС sequentialthinking** - Внешний сервис для анализа и ранжирования вакансий

## Принцип работы

1. Клиент запрашивает рекомендации через хук `useJobRecommendations`
2. API-маршрут получает вакансии из Firestore
3. Данные передаются в МПС sequentialthinking для анализа
4. МПС sequentialthinking анализирует вакансии и возвращает ранжированный список
5. Ранжированные вакансии возвращаются клиенту и отображаются в компоненте `JobRecommendations`

## Хук useJobRecommendations

React-хук `useJobRecommendations` предоставляет интерфейс для получения рекомендаций вакансий:

```typescript
const { jobs, loading, error, refresh } = useJobRecommendations(limit);
```

Параметры:
- `limit` - Максимальное количество рекомендаций (по умолчанию 10)

Возвращаемые значения:
- `jobs` - Массив рекомендуемых вакансий
- `loading` - Состояние загрузки
- `error` - Ошибка (если есть)
- `refresh` - Функция для обновления рекомендаций

## API-маршрут /api/recommendations

API-маршрут `/api/recommendations` обрабатывает POST-запросы для получения рекомендаций:

Параметры запроса:
- `userId` - ID пользователя
- `preferences` - Предпочтения пользователя
- `viewHistory` - История просмотров вакансий
- `favoriteJobs` - Избранные вакансии

Параметры URL:
- `limit` - Максимальное количество рекомендаций

Ответ:
- `200 OK` - Возвращает объект с массивом рекомендуемых вакансий
- `401 Unauthorized` - Если пользователь не авторизован
- `403 Forbidden` - Если пользователь пытается получить рекомендации для другого пользователя
- `500 Internal Server Error` - При ошибке сервера

## Интеграция с МПС sequentialthinking

Для анализа и ранжирования вакансий используется МПС sequentialthinking:

1. API-маршрут получает вакансии из Firestore
2. Данные о вакансиях, предпочтениях пользователя, истории просмотров и избранных вакансиях передаются в МПС sequentialthinking
3. МПС sequentialthinking анализирует данные и возвращает ранжированный список вакансий с оценками релевантности
4. Ранжированные вакансии возвращаются клиенту

Пример запроса к МПС sequentialthinking:

```json
{
  "action": "analyze",
  "data": {
    "jobs": [
      {
        "id": "job1",
        "title": "Frontend Developer",
        "company": "Example Corp",
        "location": "Prague",
        "salary": {
          "min": 50000,
          "max": 70000,
          "currency": "CZK"
        },
        "categories": ["IT", "Development"],
        "skills": ["JavaScript", "React", "TypeScript"],
        "type": "full-time",
        "remote": true
      }
    ],
    "userPreferences": {
      "locations": ["Prague", "Brno"],
      "categories": ["IT"],
      "jobTypes": ["full-time"],
      "salaryRange": {
        "min": 40000,
        "max": 80000
      },
      "remoteOnly": false,
      "skills": ["JavaScript", "React"]
    },
    "viewHistory": [
      {
        "id": "job2",
        "timestamp": 1626182400000
      }
    ],
    "favoriteJobs": ["job3"]
  }
}
```

Пример ответа от МПС sequentialthinking:

```json
{
  "rankedJobs": [
    {
      "id": "job1",
      "score": 0.95,
      "reasons": [
        "Matches location preference",
        "Matches category preference",
        "Matches skills preference",
        "Salary within preferred range"
      ]
    },
    {
      "id": "job4",
      "score": 0.82,
      "reasons": [
        "Matches location preference",
        "Matches category preference",
        "Partial skills match"
      ]
    }
  ]
}
```

## Алгоритм ранжирования

МПС sequentialthinking использует следующие факторы для ранжирования вакансий:

1. **Соответствие предпочтениям пользователя:**
   - Местоположение
   - Категории вакансий
   - Типы занятости
   - Диапазон зарплаты
   - Удаленная работа
   - Навыки

2. **Поведенческие факторы:**
   - История просмотров
   - Избранные вакансии

3. **Характеристики вакансии:**
   - Дата публикации
   - Количество просмотров
   - Количество откликов

Алгоритм анализирует все эти факторы и вычисляет оценку релевантности для каждой вакансии. Вакансии с наивысшими оценками рекомендуются пользователю.

## Компонент JobRecommendations

Компонент `JobRecommendations` отображает рекомендуемые вакансии:

```tsx
<JobRecommendations limit={5} showTitle={true} />
```

Параметры:
- `limit` - Максимальное количество рекомендаций (по умолчанию 5)
- `showTitle` - Показывать ли заголовок "Рекомендуемые вакансии" (по умолчанию true)

Функциональность:
- Отображение списка рекомендуемых вакансий
- Возможность обновления рекомендаций
- Добавление/удаление вакансий из избранного
- Отображение оценки релевантности для каждой вакансии

## Использование

### Добавление компонента рекомендаций на страницу

```tsx
import { JobRecommendations } from '@/components/jobs/job-recommendations';

export default function MyPage() {
  return (
    <div className="container">
      <h1>Моя страница</h1>
      <JobRecommendations limit={3} />
    </div>
  );
}
```

### Использование хука для получения рекомендаций

```tsx
import { useJobRecommendations } from '@/lib/jobRecommendations';

function MyComponent() {
  const { jobs, loading, error, refresh } = useJobRecommendations(10);
  
  // Использование данных
  return (
    <div>
      {loading && <p>Загрузка...</p>}
      {error && <p>Ошибка: {error}</p>}
      {jobs.map(job => (
        <div key={job.id}>{job.title}</div>
      ))}
      <button onClick={refresh}>Обновить</button>
    </div>
  );
}
```

## Безопасность

Система рекомендаций включает следующие меры безопасности:

1. **Проверка авторизации** - Доступ к API-маршрутам только для авторизованных пользователей
2. **Проверка прав доступа** - Пользователи могут получать рекомендации только для себя
3. **Валидация данных** - Проверка структуры и типов данных перед обработкой

## Дальнейшие улучшения

1. **Машинное обучение** - Интеграция алгоритмов машинного обучения для улучшения рекомендаций
2. **Коллаборативная фильтрация** - Использование данных о поведении похожих пользователей
3. **A/B тестирование** - Тестирование различных алгоритмов рекомендаций
4. **Обратная связь** - Учет обратной связи пользователей о релевантности рекомендаций
5. **Кэширование** - Кэширование результатов для улучшения производительности