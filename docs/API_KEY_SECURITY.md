# Руководство по безопасности API-ключей

## Обзор

API-ключи, особенно для сервисов Firebase, являются конфиденциальной информацией, требующей осторожного обращения. Хотя API-ключи Firebase имеют определенные встроенные ограничения безопасности, их раскрытие все равно может привести к несанкционированному доступу или превышению лимитов.

В этом документе описаны рекомендации по безопасной работе с API-ключами в проекте WorkInCZ.

## Текущий подход к API-ключам

### Централизация конфигурации

Все API-ключи хранятся в едином конфигурационном файле:
- `src/lib/firebase.ts` - для Next.js/TypeScript части
- `public/js/firebase-config.js` - для HTML/JS части

Это упрощает управление ключами и их ротацию при необходимости.

### Автоматическая проверка безопасности

Проект включает автоматическую проверку безопасности API-ключей с помощью GitHub Actions workflow. Проверка выполняется:
- При каждом push в ветки main/master
- При создании pull request в ветки main/master
- Еженедельно по расписанию
- По запросу вручную

Для запуска проверки локально можно использовать скрипт:
```bash
node scripts/security-check.js
```

## Безопасные практики работы с API-ключами

### ✅ Рекомендации

1. **Используйте централизованную конфигурацию**
   - Все API-ключи должны быть определены в одном месте
   - Используйте импорт для доступа к ключам из других файлов

2. **Ограничьте домены в Firebase Console**
   - Настройте ограничения по доменам для API-ключей в Firebase Console
   - Добавьте только домены, на которых будет размещено приложение

3. **Не хардкодьте ключи в коде**
   - Используйте переменные окружения для хранения ключей на сервере
   - Для клиентской части используйте централизованную конфигурацию

4. **Регулярно проверяйте использование ключей**
   - Мониторьте использование API через Firebase Console
   - Настройте уведомления о необычной активности

5. **Используйте разные ключи для разных окружений**
   - Разделяйте ключи для разработки, тестирования и продакшена
   - Создайте отдельные проекты Firebase для разных окружений

### ❌ Запрещенные практики

1. **Не добавляйте API-ключи в исходный код тестов**
   - Используйте моки или переменные окружения для тестов

2. **Не хардкодьте ключи в HTML-файлы**
   - Используйте JavaScript для загрузки конфигурации

3. **Не включайте API-ключи в переменные URL**
   - Это повышает риск их попадания в логи и историю браузера

4. **Не используйте устаревшие ключи**
   - Регулярно проверяйте и удаляйте все устаревшие ключи

5. **Не оставляйте ключи в резервных копиях на GitHub**
   - При необходимости создания резервных копий используйте приватные хранилища
   - Используйте `.gitignore` для исключения файлов с секретами

## Процедура ротации API-ключей

При необходимости замены API-ключа (например, при подозрении на компрометацию):

1. **Создайте новый ключ** в Firebase Console

2. **Обновите конфигурационные файлы**:
   - `src/lib/firebase.ts`
   - `public/js/firebase-config.js`

3. **Запустите скрипт проверки** для поиска устаревших ключей:
   ```bash
   node scripts/security-check.js
   ```

4. **Запустите скрипт замены** для автоматической замены ключей:
   ```bash
   node scripts/fix-firebase-api-keys.js
   ```

5. **Проверьте изменения** и создайте pull request

6. **После деплоя** ограничьте или удалите старый ключ в Firebase Console

## Мониторинг и реагирование на инциденты

### Мониторинг

- Регулярно проверяйте использование API-ключей в Firebase Console
- Настройте оповещения о превышении лимитов или необычной активности

### Реагирование на инциденты

Если ключ был скомпрометирован:

1. Немедленно создайте новый ключ
2. Ограничьте или удалите скомпрометированный ключ
3. Обновите все конфигурационные файлы
4. Выполните экстренное развертывание обновлений

## Дополнительные ресурсы

- [Firebase API Key Best Practices](https://firebase.google.com/docs/projects/api-keys)
- [Google Cloud Key Management](https://cloud.google.com/security-key-management)
- [OWASP API Security Top 10](https://owasp.org/API-Security/editions/2023/en/0x00-introduction/)