name: üîê Secure Firebase Deploy

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: üîç Check for exposed secrets
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —É—Ç–µ—á–∫—É —Å–µ–∫—Ä–µ—Ç–æ–≤..."
          if grep -r "AIzaSy" public/; then
            echo "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏!"
            exit 1
          fi
          echo "‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"

  deploy:
    needs: security-check
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v4
      
      - name: üîß Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: üîê Replace API Key with environment variable
        run: |
          echo "üîê –ó–∞–º–µ–Ω—è–µ–º API –∫–ª—é—á –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
          sed -i 's/AIzaSyAo34JvPwyqjwzjhd-d-qEKh7HqAAWsIiM/${{ secrets.FIREBASE_API_KEY }}/g' public/js/firebase-config.js
          echo "‚úÖ API –∫–ª—é—á –∑–∞–º–µ–Ω–µ–Ω"
          
      - name: üî• Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          projectId: workincz-759c7
          channelId: live
          
      - name: üìä Deploy Status
        run: |
          echo "üöÄ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
          echo "üåê –°–∞–π—Ç: https://workincz-759c7.web.app"
          echo "üîê API –∫–ª—é—á –∑–∞—â–∏—â–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è" 