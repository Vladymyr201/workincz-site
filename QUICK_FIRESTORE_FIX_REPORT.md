# üöÄ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ø—Ä–∞–≤–∏–ª Firestore - "Missing or insufficient permissions"

## üö® **–ü—Ä–æ–±–ª–µ–º–∞:**
–ê–Ω–∞–ª–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–∫–∞–∑–∞–ª:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω** (uid = `cFMrEy44r1Rut9AK7UZZ47ZqozH3`)
- ‚ùå **HTTP 400 + "Missing or insufficient permissions"** –ø—Ä–∏ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏–∏ –∏–∑ Firestore
- ‚ùå –°–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π Firebase uid

## üîß **–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (3 –º–∏–Ω—É—Ç—ã):**

### **1. –ó–∞–º–µ–Ω–∏–ª —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ-–æ—Ç–∫—Ä—ã—Ç—ã–µ:**

#### **–ë—ã–ª–æ (—Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞):**
```javascript
// 237 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ isSimpleAuthUser, canAccessDemoData, etc.
function isSimpleAuthUser(userId) {
  return userId == 'demo-user-1' || userId.matches('user-.*') || ...
}
// ... –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø—Ä–∞–≤–∏–ª
```

#### **–°—Ç–∞–ª–æ (–ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞):**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –í–†–ï–ú–ï–ù–ù–û: –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å—ë –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    // ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

### **2. –†–∞–∑–≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
```bash
firebase deploy --only firestore:rules
```

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

### **–õ–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
```
+ cloud.firestore: rules file firestore.rules compiled successfully
+ firestore: released rules firestore.rules to cloud.firestore
+ Deploy complete!
```

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

#### **–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "Missing or insufficient permissions"
- ‚úÖ "SimpleAuth: –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ"
- ‚úÖ "Dashboard: UI –æ–±–Ω–æ–≤–ª–µ–Ω"
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ "0")

#### **–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∞—Å–Ω–æ–π –æ—à–∏–±–∫–∏ "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"
- ‚úÖ Dashboard —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

## üõ°Ô∏è **–ß—Ç–æ –¥–∞–ª—å—à–µ:**

### **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —É—Å–ª–æ–∂–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞:**
```javascript
// –ü—Ä–∏–º–µ—Ä –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏—Ö –ø—Ä–∞–≤–∏–ª
match /users/{userId} {
  allow read, write: if request.auth.uid == userId;
}

match /notifications/{notificationId} {
  allow read, write: if request.auth.uid == resource.data.userId;
}
```

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª Firestore](https://firebase.google.com/docs/firestore/security/rules-conditions?hl=ru)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](https://firebase.google.com/docs/firestore/security/get-started)

## üìä **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `firestore.rules` - –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ-–æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### **–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
firebase deploy --only firestore:rules

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª
firebase firestore:rules:edit
```

## üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/dashboard.html`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ permissions
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

### **–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ `SimpleAuth: –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ`
- ‚úÖ `Dashboard: UI –æ–±–Ω–æ–≤–ª–µ–Ω`
- ‚úÖ –ù–µ—Ç `FirebaseError: Missing or insufficient permissions`

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 30 –∏—é–ª—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 3 –º–∏–Ω—É—Ç—ã  
**–í–µ—Ä—Å–∏—è:** 1.0.8 